# FastMath C++ ライブラリ
[English](./README.md) | 日本語

精度を維持しながら標準C++数学関数より高速な代替手段を提供する高性能数学ライブラリです。

## 概要

FastMathは、最適化された数学計算を必要とするアプリケーション向けに設計された包括的な数学ライブラリです。多項式近似、範囲縮小、ビット操作、ハイブリッド実装などの高度な最適化技術を使用して25の数学関数を実装しています。

## 特徴

- **25の最適化関数**: 三角関数、指数関数、対数関数、ユーティリティ関数、双曲線関数の完全なセット
- **高精度**: パフォーマンスの向上を提供しながら優れた精度を維持
- **クロスプラットフォーム**: x86およびARMアーキテクチャに最適化
- **ハイブリッド実装**: 入力範囲に基づいて最適な方法を自動選択
- **ヘッダーオンリー設計**: クリーンなAPIによる簡単な統合

## パフォーマンス結果

### x86デスクトップ性能

| 関数 | 高速化 | ステータス |
|------|--------|------------|
| **atan2** | **3.76倍** | ✅ 高速 |
| **sinh** | **2.97倍** | ✅ 高速 |
| **atanh** | **2.86倍** | ✅ 高速 |
| **tanh** | **2.69倍** | ✅ 高速 |
| **tan** | **1.55倍** | ✅ 高速 |
| **cos** | **1.07倍** | ✅ 高速 |
| **fmod** | **1.08倍** | ✅ 高速 |
| **sin** | **1.05倍** | ✅ 高速 |

### Raspberry Pi 4性能

| 関数 | 高速化 | ステータス |
|------|--------|------------|
| **atan2** | **4.42倍** | ✅ 高速 |
| **atanh** | **2.79倍** | ✅ 高速 |
| **sinh** | **2.30倍** | ✅ 高速 |
| **tanh** | **1.99倍** | ✅ 高速 |
| **tan** | **1.51倍** | ✅ 高速 |
| **sin** | **1.46倍** | ✅ 高速 |
| **fmod** | **1.22倍** | ✅ 高速 |
| **cos** | **1.16倍** | ✅ 高速 |

## サポートする関数

### 三角関数
- `sin(x)` - 多項式近似による高速サイン
- `cos(x)` - 多項式近似による高速コサイン
- `tan(x)` - sin/cos比による高速タンジェント
- `asin(x)` - ニュートン・ラフソン法による高速アークサイン
- `acos(x)` - ニュートン・ラフソン法による高速アークコサイン
- `atan2(y, x)` - CORDICインスパイアアルゴリズムによる高速アークタンジェント2

### 指数・対数関数
- `exp(x)` - 範囲縮小と多項式近似による高速指数関数
- `log(x)` - ビット操作と多項式近似による高速自然対数
- `log10(x)` - 高速常用対数
- `log2(x)` - 高速二進対数
- `pow(base, exp)` - 特殊ケース最適化による高速べき乗関数

### ユーティリティ関数
- `sqrt(x)` - ビット操作初期値を使用したニュートン・ラフソン法による高速平方根
- `fmod(x, y)` - ハイブリッド浮動小数点剰余（小さな値は高速、大きな値はstd::fmod）
- `ceil(x)` - ビット操作による高速天井関数
- `floor(x)` - ビット操作による高速床関数
- `round(x)` - 高速四捨五入関数

### 双曲線関数
- `sinh(x)` - 最適化exp関数による高速双曲線サイン
- `cosh(x)` - 最適化exp関数による高速双曲線コサイン
- `tanh(x)` - 有理近似による高速双曲線タンジェント
- `asinh(x)` - 高速逆双曲線サイン
- `acosh(x)` - 高速逆双曲線コサイン
- `atanh(x)` - 高速逆双曲線タンジェント

## 使用方法

### 基本的な使用法

```cpp
#include "fast_math.hpp"

int main() {
    float angle = 1.5707963f; // π/2

    // FastMath関数を使用
    float sin_val = FastMath::sin(angle);
    float cos_val = FastMath::cos(angle);
    float sqrt_val = FastMath::sqrt(16.0f);

    // 双曲線関数
    float sinh_val = FastMath::sinh(1.0f);
    float tanh_val = FastMath::tanh(0.5f);

    return 0;
}
```

### CMake統合

```cmake
# プロジェクトにFastMathを含める
add_subdirectory(path/to/fast_math_cpp)

# ターゲットにリンク
target_link_libraries(your_target fast_math_cpp)
```

## ビルド

### 要件
- CMake 3.16以上
- C++17対応コンパイラ
- Google Test（テスト用）

### ビルド手順

```bash
mkdir build && cd build
cmake ..
make

# テスト実行
./fast_math_test
```

### ビルドオプション

```bash
# 共有ライブラリとしてビルド
cmake -DFAST_MATH_BUILD_SHARED_LIBS=ON ..

# テストを無効化
cmake -DBUILD_TESTS=OFF ..
```

## 実装技術

### 最適化手法
- **多項式近似**: 高精度のためのテイラー級数とパデ近似
- **範囲縮小**: より良い多項式収束のための入力範囲削減
- **ビット操作**: exp/log関数のためのIEEE 754浮動小数点最適化
- **ニュートン・ラフソン法**: sqrtと逆関数の反復的精密化
- **二進べき乗**: 高速整数べき乗演算
- **ハイブリッド戦略**: 精度重要範囲での標準ライブラリへの自動フォールバック

### 精度保証
- 三角関数: < 0.01 絶対誤差
- 平方根: < 1e-5 絶対誤差
- 指数・対数: < 0.01 相対誤差
- 双曲線関数: < 5e-5 絶対誤差
- ユーティリティ関数: 小さな値で完全精度

## アーキテクチャサポート

ライブラリは複数のアーキテクチャに最適化されています：

- **x86/x64**: Intel/AMDプロセッサで優れた性能
- **ARM**: ARM Cortexプロセッサに最適化（Raspberry Pi 4でテスト済み）
- **クロスプラットフォーム**: すべてのサポートプラットフォームで一貫したAPI

## テスト

包括的なテストスイートには以下が含まれます：
- **精度テスト**: 標準ライブラリとの精度検証
- **性能テスト**: 速度向上のベンチマーク
- **エッジケーステスト**: 特殊値と境界条件の処理

## ライセンス

このプロジェクトはMITライセンスの下でライセンスされています。詳細については [LICENSE](./LICENSE) ファイルを参照してください。

## 貢献

貢献を歓迎します！以下を確認してください：
- すべてのテストが通過すること
- コードが既存のスタイル規約に従うこと
- 性能改善が文書化されていること
- クロスプラットフォーム互換性が維持されていること

## ベンチマーク結果

ライブラリはプラットフォーム間で一貫した性能向上を示し、特にRaspberry Pi 4のようなリソース制約システムで強い結果を示しています。ハイブリッド実装戦略により、すべての入力範囲で速度と精度の両方が維持されます。

詳細なベンチマーク結果については、プラットフォーム固有のテスト出力を含む `sample_result/` ディレクトリを参照してください。

## プラットフォーム別性能分析

### 興味深い観察結果

#### **基本三角関数でのRaspberry Pi優位性**
- **sin関数**: x86 (1.05倍) → RPi4 (1.46倍)
- **cos関数**: x86 (1.07倍) → RPi4 (1.16倍)
- ARM CPUの標準math関数が相対的に遅いため、独自実装の効果が大きい

#### **複雑な関数でのx86優位性**
- **sinh関数**: x86 (2.97倍) → RPi4 (2.30倍)
- **tanh関数**: x86 (2.69倍) → RPi4 (1.99倍)
- 高性能CPUほど複雑な計算での高速化効果が大きい

#### **一貫して高性能な関数**
- **atan2**: 両プラットフォームで最高の高速化（x86: 3.76倍、RPi4: 4.42倍）
- **atanh**: 安定した高速化（x86: 2.86倍、RPi4: 2.79倍）

### 実用的意義

このライブラリは、リソース制約のある環境（Raspberry Pi 4など）でこそその真価を発揮し、限られた計算資源でも高性能な数学演算を実現します。プラットフォームに応じて効果的な関数が異なるため、用途に応じた最適化戦略が可能です。